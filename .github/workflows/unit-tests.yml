name: Unit Tests
on: [push]
jobs:
  test:
    runs-on: ubuntu-22.04
    strategy:
      matrix:
        profile:
          - compiler: g++
            filename: ./conan/gcc.profile
          - compiler: clang++
            filename: ./conan/clang.profile
        build_type: [Release, Debug]
    steps:
      - uses: actions/checkout@v3
      - uses: turtlebrowser/get-conan@main
      - run: sudo apt-get install -y autopoint
      - run: conan install . -pr:b=${{ matrix.profile.filename }} -pr:h=${{ matrix.profile.filename }} -s build_type=${{ matrix.build_type }} --build=missing
      - run: cmake . -DCMAKE_TOOLCHAIN_FILE=conan_toolchain.cmake -DCMAKE_BUILD_TYPE=${{ matrix.build_type }} -DCMAKE_CXX_COMPILER=${{ matrix.profile.compiler }} -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
      - run: cat compile_commands.json
      - run: cmake --build .
      - run: ./nonrec-test
      - run: ./nonrec-bench
